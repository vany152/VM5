<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>architecture coursework: Основные моменты по архитектуре виртуальной машины</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">architecture coursework
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md__d__study_architectury_architectury_coursework__r_e_a_d_m_e.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Основные моменты по архитектуре виртуальной машины </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md0"></a>
Требования к реализации</h1>
<p >0. Реализовать интерпретатор как консольное приложение.</p><ol type="1">
<li>Объектно-ориентированный подход.<ol type="a">
<li>Процессор – отдельный класс, разделение на интерфейс и реализацию. <br  />
 Выполнение команд – вызов функтора (не использовать оператор-переключатель!). <br  />
 Память – динамический массив, поле-указатель в классе.</li>
<li>Команды процессора – иерархия классов-функторов. <br  />
 Базовый класс – абстрактный класс <a class="el" href="struct_command.html" title="базовый класс команды процессора.">Command</a> с перегруженной операцией operator() <br  />
<br  />
</li>
</ol>
</li>
<li><p class="startli">Разработать и описать в пояснительной записке:</p><ul>
<li>коды команд</li>
<li>методы адресации операндов</li>
<li>множество флагов-результатов</li>
<li>форматы команд переходов (если не определены) <br  />
<br  />
</li>
</ul>
<p class="startli">Обязательно должны быть реализованы команды:</p><ol type="a">
<li>Пересылки (по необходимости)</li>
<li>Арифметика (целые и дробные)</li>
<li>Сравнения (целые и дробные)</li>
<li>Ввод-вывод (целые и дробные)</li>
<li>Переходы:<ul>
<li>безусловный</li>
<li>условный</li>
<li>к подпрограмме</li>
<li>возврат из подпрограммы <br  />
<br  />
</li>
</ul>
</li>
</ol>
</li>
<li>Загрузчик программы для виртуальной машины – независимая функция, вызываемая главной программой интерпретатора. 3.1 Код программы для виртуальной машины должен быть записан в текстовом файле. 3.2 Формат представления кода программы в файле должен быть разработан и описан в пояснительной записке. 3.3 Загрузчик должен быть способен загружать код программы по любому адресу памяти 3.3 Главная программа должна получать имя файла как параметр командной строки, и передавать загрузчику как параметр при вызове.</li>
</ol>
<h1><a class="anchor" id="autotoc_md1"></a>
Вариант 5</h1>
<h2><a class="anchor" id="autotoc_md2"></a>
Двухадресная, с Регистрами Общего Назначения, один операнд в регистре</h2>
<p ><a class="el" href="struct_p_s_w.html">PSW</a> = IP + Flags, 16+16 = 32 бит. <br  />
 Память – байтовая, объединяются в 2 и 4 байта. Размер адреса – 16 бит. Данные:</p>
<ul>
<li>Короткие целые знаковые, беззнаковые – 2 байта</li>
<li>Длинные целые знаковые, беззнаковые – 4 байта</li>
<li>Дробные – 4 байта</li>
</ul>
<p >РОН – 8 штук, 16 бит; содержимое – короткое целое со знаком, короткое целое без знака (адрес). <br  />
 Они же – 4 регистра для длинных целых по 32 бита, номера – четные. <br  />
 Они же – 4 регистра с плавающей точкой по 32 бита, номера – четные.</p>
<p >Структура команд: 2 байта, 4 байта; результат по первому</p>
<ul>
<li>16 бит: l - 1 бит, КОП – 6 бит, s – 1 бит, r1 – 4 бита, r2 – 4 бита</li>
<li>32 бита: l - 1 бит, КОП – 6 бит, s – 1 бит, r1 – 4 бита, r2 – 4 бита, offset – 16 бит</li>
<li>l - длина команды<ul>
<li>l = 0 - 2 байта</li>
<li>l = 1 - 4 байта</li>
</ul>
</li>
<li>s – размер целого операнда<ul>
<li>s = 0 – 2 байта</li>
<li>s = 1 – 4 байта</li>
</ul>
</li>
</ul>
<p >Адрес = регистр + смещение (если регистр используется). <br  />
 Адрес = смещение (если регистр не используется). <br  />
 Смещение = адрес = константа. Особые случаи: s=1, номер регистра – нечетный.</p>
<p >Это формат пересылок, арифметики целой, арифметики дробной; Пересылка:</p>
<ul>
<li>Регистр-регистр</li>
<li>Регистр-память</li>
<li>Память-регистр</li>
<li>арифметика дробная, арифметика целая – то же самое</li>
</ul>
<p >Переходы:</p>
<ul>
<li>безусловный (использование битов s), r1 – не используется<ul>
<li>s = 0: прямой, IP = адрес</li>
<li>s = 1: относительный, IP = IP + адрес.</li>
</ul>
</li>
<li>условный — то же самое, только проверяются флаги</li>
<li>вызов подпрограммы: адрес возврата запоминается в регистре – первый операнд</li>
<li>возврат – безусловный прямой переход</li>
<li>Если регистр в команде не используется, то на месте номера регистра стоит 1xxx;</li>
<li><em><b>Можно использовать для дополнительных кодов операций!</b></em></li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md4"></a>
Процессор</h1>
<p ><a class="el" href="struct_p_s_w.html">PSW</a> - Program State Word</p>
<ul>
<li>IP - 16 байт</li>
<li>Флаги: 0. CF - carry flag (флаг переноса)<ol type="1">
<li>ZF - zero flag</li>
<li>SF - sign flag</li>
<li>OF - overflow flag</li>
<li><em>reserved</em></li>
</ol>
</li>
<li>OF имеет значение для знаковых чисел. Равен старшему биту числа (например, для 16-битных чисел проверяется 16 бит, для 64-битных - 64 бит)</li>
<li>CF имеет значение для беззнаковых чисел. Выставляется при переносе стершего бита в следующий за ним (например, для 16-битных - 17 бит, для 64-битных - 65 бит)</li>
</ul>
<p >Числа</p>
<ul>
<li>short int, short uint - 2 байта</li>
<li>long int, long uint - 4 байта</li>
<li>float - 4 байта</li>
</ul>
<p >РОН - Регистры Общего Назначения</p>
<ul>
<li>8 штук, по 16 бит каждый<ul>
<li>R0 <em>short</em></li>
<li>R1 <em>short</em></li>
<li>R2 <em>short</em></li>
<li>R3 <em>short</em></li>
<li>R4 <em>short</em></li>
<li>R5 <em>short</em></li>
<li>R6 <em>short</em></li>
<li>R7 <em>short</em> <br  />
 или</li>
<li>R0 <em>long, float</em></li>
<li>R2 <em>long, float</em></li>
<li>R4 <em>long, float</em></li>
<li>R6 <em>long, float</em></li>
</ul>
</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md6"></a>
Команды процессора</h1>
<p >Результат команды по первому регистру. <br  />
 Арифметика выполняется только на регистрах.</p>
<p >Команды процессора двух типов: короткая (16 бит) и длинная (32 бит).</p>
<ul>
<li>16 бит: l - 1 бит, КОП – 6 бит, s – 1 бит, r1 – 4 бита, r2 – 4 бита</li>
<li>32 бита: l - 1 бит, КОП – 6 бит, s – 1 бит, r1 – 4 бита, r2 – 4 бита, offset – 16 бит</li>
<li>l - размер команды</li>
<li>l = 0 - 2 байта</li>
<li>l = 1 - 4 байта</li>
<li>s – размер целого операнда</li>
<li>s = 0 – 2 байта</li>
<li>s = 1 – 4 байта</li>
<li>если регистр не используется, на его месте стоит "15"</li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Арифметические команды</h2>
<ul>
<li>add - целочисленное сложение</li>
<li>adc - целочисленное сложение с учетом CF</li>
<li>inc - инкремент числа</li>
<li>radd - вещественное сложение</li>
<li>sub - целочисленное вычитание</li>
<li>sbb - целочисленное вычитание с учетом CF</li>
<li>dec - декремент числа</li>
<li>rsub - вещественное вычитание</li>
<li>mul - беззнаковое умножение</li>
<li>imul - знаковое умножение</li>
<li>rmul - вещественное умножение</li>
<li>div - беззнаковое деление</li>
<li>idiv - знаковое деление</li>
<li>rdiv - вещественное деление</li>
</ul>
<h2><a class="anchor" id="autotoc_md8"></a>
Пересылки</h2>
<ul>
<li>mov - пересылка регистр-регистр</li>
<li>load - пересылка память-регистр</li>
<li>store - пересылка регистр-память</li>
<li>fill - заполнение регистра числом из offset'а команды</li>
</ul>
<h2><a class="anchor" id="autotoc_md9"></a>
Ввод - вывод</h2>
<ul>
<li>in - ввод с клавиатуры беззнакового числа</li>
<li>iin - ввод с клавиатуры знакового числа</li>
<li>rin - ввод с клавиатуры вещественного числа</li>
<li>out - вывод в консоль беззнакового числа</li>
<li>iout - вывод в консоль знакового числа</li>
<li>rout - вывод в консоль вещественного числа</li>
</ul>
<h2><a class="anchor" id="autotoc_md10"></a>
Сравнение</h2>
<ul>
<li>cmp - целочисленное сравнение</li>
<li>rcmp - вещественное сравнение</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Переходы</h2>
<ul>
<li>безусловные:<ul>
<li>jmp - безусловный прямой</li>
<li>call - вызов процедуры</li>
<li>ret - возврат из процедуры</li>
</ul>
</li>
<li>условные:<ul>
<li>je - jump equal</li>
<li>jne - jump not equal</li>
<li>знаковые:<ul>
<li>jg - jump greater</li>
<li>jge - jump greater \ equal</li>
<li>jl - jump lower</li>
<li>jle - jump lower \ equal</li>
<li>jo - jump overflow</li>
</ul>
</li>
<li>беззнаковые:<ul>
<li>ja - jump above</li>
<li>jae - jump above \ equal</li>
<li>jb - jump below</li>
<li>jbe - jump below \ equal</li>
<li>jc - jump carry</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
Оперативная память</h1>
<p >Размер адреса - 16 бит =&gt; размер оперативной памяти = 65536 байт = 64 кБ. <br  />
</p>
<p >Память представлена динамическим массивом типа byte (unsigned char или uint8_t). <br  />
</p>
<p >Адресация памяти - байтовая, байты объединяются в слова (word) по 2 байта и в двойные слова (dword) по 4 байта. <br  />
</p>
<p >Биты команд в памяти располагаются в обратном порядке</p>
<h1><a class="anchor" id="autotoc_md13"></a>
Формат файла с программой</h1>
<p >Формат файла - текстовый</p>
<p >Длина строки не более 256 символов (включая пробельные символы)</p>
<p >В одной строке записывается одна команда в формате: <em><b>p opcode s r1 r2 [offset]</b></em>, где: <br  />
 <em><b>p</b></em> - префикс, <br  />
 <em><b>opcode</b></em> - код операции (десятичное число), <br  />
 <em><b>s</b></em> - размер операнда (0 или 1), <br  />
 <em><b>r1</b></em> - номер первого регистра, <br  />
 <em><b>r2</b></em> - номер второго регистра (15, если не используется), <br  />
 <em><b>offset</b></em> - смещение (не пишется в случае короткой команды)</p>
<p >Префиксы строки:</p><ul>
<li>e - execute</li>
<li>; (точка с запятой) - комментарий, до конца строки</li>
<li>числа:<ul>
<li>a - address</li>
<li>s - short (2 байта)</li>
<li>l - long (4 байта)</li>
<li>r - real</li>
</ul>
</li>
<li>команды:<ul>
<li>t - tiny (2 байта)</li>
<li>b - big (4 байта) </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2 </li>
  </ul>
</div>
</body>
</html>
